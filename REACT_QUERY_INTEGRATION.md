# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è React Query - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `@tanstack/react-query`
2. ‚úÖ –°–æ–∑–¥–∞–Ω `QueryProvider` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `app/(miniapp)/layout.tsx`
4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Ö—É–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π:
   - `usePlan()` / `useGeneratePlan()`
   - `useRecommendations()`
   - `useWishlist()` / `useAddToWishlist()` / `useRemoveFromWishlist()`
   - `useCart()` / `useAddToCart()` / `useRemoveFromCart()`
   - `useProfile()`
   - `useAnalysis()`

## üìù –ü—Ä–∏–º–µ—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ React Query

### –ü—Ä–∏–º–µ—Ä 1: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

**–ë—ã–ª–æ:**
```typescript
const [recommendations, setRecommendations] = useState<Recommendation | null>(null);
const [loading, setLoading] = useState(true);

const loadRecommendations = async () => {
  try {
    setLoading(true);
    const data = await api.getRecommendations();
    setRecommendations(data);
  } catch (err) {
    setError(err);
  } finally {
    setLoading(false);
  }
};

useEffect(() => {
  loadRecommendations();
}, []);
```

**–°—Ç–∞–ª–æ:**
```typescript
import { useRecommendations } from '@/hooks/useRecommendations';

const { data: recommendations, isLoading: loading, error } = useRecommendations();
// recommendations —É–∂–µ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

### –ü—Ä–∏–º–µ—Ä 2: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–ª–∞–Ω–∞

**–ë—ã–ª–æ:**
```typescript
const [plan, setPlan] = useState(null);
const [loading, setLoading] = useState(true);

useEffect(() => {
  const loadPlan = async () => {
    try {
      const planData = await api.getPlan();
      setPlan(planData);
    } catch (err) {
      // handle error
    } finally {
      setLoading(false);
    }
  };
  loadPlan();
}, []);
```

**–°—Ç–∞–ª–æ:**
```typescript
import { usePlan, useGeneratePlan } from '@/hooks/usePlan';

const { data: plan, isLoading: loading, error } = usePlan();
const generatePlan = useGeneratePlan();

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞
const handleGenerate = async () => {
  await generatePlan.mutateAsync();
  // –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
};
```

### –ü—Ä–∏–º–µ—Ä 3: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ

**–ë—ã–ª–æ:**
```typescript
const [wishlist, setWishlist] = useState([]);

const addToWishlist = async (productId: number) => {
  try {
    await api.addToWishlist(productId);
    // –ù—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
    const updated = await api.getWishlist();
    setWishlist(updated.items);
  } catch (err) {
    // handle error
  }
};
```

**–°—Ç–∞–ª–æ:**
```typescript
import { useWishlist, useAddToWishlist } from '@/hooks/useWishlist';

const { data: wishlist } = useWishlist();
const addToWishlist = useAddToWishlist();

const handleAdd = async (productId: number) => {
  await addToWishlist.mutateAsync(productId);
  // –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
};
```

## üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ staleTime:
- **–ü–ª–∞–Ω**: 10 –º–∏–Ω—É—Ç (—Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: 5 –º–∏–Ω—É—Ç
- **–ü—Ä–æ—Ñ–∏–ª—å**: 5 –º–∏–Ω—É—Ç
- **–ê–Ω–∞–ª–∏–∑**: 10 –º–∏–Ω—É—Ç
- **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ**: 2 –º–∏–Ω—É—Ç—ã (–º–æ–∂–µ—Ç —á–∞—Å—Ç–æ –º–µ–Ω—è—Ç—å—Å—è)
- **–ö–æ—Ä–∑–∏–Ω–∞**: 1 –º–∏–Ω—É—Ç–∞ (–º–æ–∂–µ—Ç —á–∞—Å—Ç–æ –º–µ–Ω—è—Ç—å—Å—è)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- ‚ùå –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –æ–∫–Ω–∞ (`refetchOnWindowFocus: false`)
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ç–∏ (`refetchOnReconnect: true`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ, –∫–æ—Ä–∑–∏–Ω—ã)

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. `app/(miniapp)/page.tsx` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
2. `app/(miniapp)/plan/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–ª–∞–Ω–∞
3. `app/(miniapp)/cart/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
4. `app/(miniapp)/analysis/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞
5. `app/(miniapp)/profile/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è
6. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ/–∫–æ—Ä–∑–∏–Ω—ã

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
7. –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å API –≤—ã–∑–æ–≤–∞–º–∏

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ React Query

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ñ–æ–Ω–µ
3. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É, –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
4. **Retry –ª–æ–≥–∏–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
5. **Deduplication** - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è
6. **Devtools** - —É–¥–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –≤ development —Ä–µ–∂–∏–º–µ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ —Å–º–µ—à–∏–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—ã** - –µ—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React Query, —Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ API –≤—ã–∑–æ–≤—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
2. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞** - –ø–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–π (POST/PUT/DELETE) –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –ª—É—á—à–µ–≥–æ UX (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)

## üîß –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ/–∫–æ—Ä–∑–∏–Ω—ã
2. –î–æ–±–∞–≤–∏—Ç—å prefetching –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å background sync –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
4. –î–æ–±–∞–≤–∏—Ç—å infinite queries –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)

