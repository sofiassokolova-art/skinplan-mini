# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º—ã:
1. **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - `app/(miniapp)/quiz/page.tsx` —Å–æ–¥–µ—Ä–∂–∏—Ç **7900+ —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞
2. **–°–ª–æ–∂–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º** - 203 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—É–∫–æ–≤ (useState, useEffect, useRef, useMemo, useCallback)
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É state, refs –∏ State Machine
4. **React Query –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** - —Ö–æ—Ç—è —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
5. **–ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

---

## üéØ –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–∞ –º–æ–¥—É–ª–∏**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- `quiz/page.tsx` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥, –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### –†–µ—à–µ–Ω–∏–µ:
–†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏:

```
app/(miniapp)/quiz/
‚îú‚îÄ‚îÄ page.tsx                    # –¢–æ–ª—å–∫–æ –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (50-100 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ QuizContainer.tsx       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ QuizLoader.tsx          # –õ–æ–∞–¥–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ QuizInitializer.tsx     # –õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ InfoScreenView.tsx     # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏–Ω—Ñ–æ-—ç–∫—Ä–∞–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ QuestionView.tsx        # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–æ–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ QuizFinalizer.tsx      # –õ–æ–≥–∏–∫–∞ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useQuizData.ts         # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ React Query
‚îÇ   ‚îú‚îÄ‚îÄ useQuizState.ts        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (—É–∂–µ –µ—Å—Ç—å, —É–ª—É—á—à–∏—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ useQuizNavigation.ts   # –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ useQuizProgress.ts     # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—É–∂–µ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ quizSync.ts            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è state/refs/State Machine
    ‚îî‚îÄ‚îÄ quizValidation.ts      # –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –¥–µ–±–∞–∂–∏—Ç—å
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 –¥–Ω—è

---

### 2. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ React Query –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ loading/error —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏

#### –†–µ—à–µ–Ω–∏–µ:
–°–æ–∑–¥–∞—Ç—å —Ö—É–∫–∏ –¥–ª—è quiz –¥–∞–Ω–Ω—ã—Ö:

```typescript
// hooks/useQuizData.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { api } from '@/lib/api';

const QUIZ_QUERY_KEY = 'quiz';
const QUIZ_PROGRESS_QUERY_KEY = 'quiz-progress';

export function useQuestionnaire() {
  return useQuery({
    queryKey: [QUIZ_QUERY_KEY, 'active'],
    queryFn: () => api.getActiveQuestionnaire(),
    staleTime: 10 * 60 * 1000, // 10 –º–∏–Ω—É—Ç (–∞–Ω–∫–µ—Ç–∞ —Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è)
    gcTime: 30 * 60 * 1000, // 30 –º–∏–Ω—É—Ç –≤ –∫—ç—à–µ
  });
}

export function useQuizProgress() {
  return useQuery({
    queryKey: [QUIZ_PROGRESS_QUERY_KEY],
    queryFn: () => api.getQuizProgress(),
    staleTime: 2 * 60 * 1000, // 2 –º–∏–Ω—É—Ç—ã
  });
}

export function useSaveQuizProgress() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: (data: { answers: Record<number, string | string[]>, questionIndex: number }) => 
      api.saveQuizProgress(data),
    onSuccess: () => {
      // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
      queryClient.invalidateQueries({ queryKey: [QUIZ_PROGRESS_QUERY_KEY] });
    },
  });
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
// –í–º–µ—Å—Ç–æ:
const [questionnaire, setQuestionnaire] = useState(null);
const [loading, setLoading] = useState(true);
useEffect(() => {
  const load = async () => {
    try {
      setLoading(true);
      const data = await api.getActiveQuestionnaire();
      setQuestionnaire(data);
    } finally {
      setLoading(false);
    }
  };
  load();
}, []);

// –°—Ç–∞–Ω–µ—Ç:
const { data: questionnaire, isLoading: loading, error } = useQuestionnaire();
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ (—É–±–∏—Ä–∞–µ–º ~100 —Å—Ç—Ä–æ–∫)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 1 –¥–µ–Ω—å

---

### 3. **–£–ø—Ä–æ—â–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –°–ª–æ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É `questionnaire` state, `questionnaireRef`, –∏ `quizStateMachine.questionnaire`
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ useEffect –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –†–∏—Å–∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ (React error #310)

#### –†–µ—à–µ–Ω–∏–µ:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (State Machine) –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏:

```typescript
// lib/quiz/utils/quizSync.ts
import { useEffect, useRef } from 'react';

/**
 * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç ref —Å State Machine (–æ–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
 * State Machine -> Ref -> State (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
 */
export function useQuizSync(
  stateMachineQuestionnaire: Questionnaire | null,
  setQuestionnaire: (q: Questionnaire | null) => void,
  questionnaireRef: React.MutableRefObject<Questionnaire | null>
) {
  const lastSyncedIdRef = useRef<number | null>(null);
  
  useEffect(() => {
    // –ï—Å–ª–∏ State Machine –∏–∑–º–µ–Ω–∏–ª—Å—è, –æ–±–Ω–æ–≤–ª—è–µ–º ref –∏ state
    if (stateMachineQuestionnaire?.id !== lastSyncedIdRef.current) {
      questionnaireRef.current = stateMachineQuestionnaire;
      if (stateMachineQuestionnaire) {
        setQuestionnaire(stateMachineQuestionnaire);
      }
      lastSyncedIdRef.current = stateMachineQuestionnaire?.id ?? null;
    }
  }, [stateMachineQuestionnaire?.id]); // –ó–∞–≤–∏—Å–∏–º —Ç–æ–ª—å–∫–æ –æ—Ç ID
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–µ–Ω—å—à–µ useEffect
- ‚úÖ –ù–µ—Ç —Ä–∏—Å–∫–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
- ‚úÖ –ü—Ä–æ—â–µ –¥–µ–±–∞–∂–∏—Ç—å

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 0.5 –¥–Ω—è

---

### 4. **–í—ã–Ω–æ—Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–º–µ—à–∞–Ω–∞ —Å UI

#### –†–µ—à–µ–Ω–∏–µ:
–°–æ–∑–¥–∞—Ç—å —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏:

```typescript
// lib/quiz/services/quizNavigation.ts
export class QuizNavigationService {
  static getNextInfoScreen(
    currentIndex: number,
    infoScreens: InfoScreen[],
    answers: Record<number, string | string[]>
  ): InfoScreen | null {
    // –ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ side effects
  }
  
  static getNextQuestion(
    currentIndex: number,
    filteredQuestions: Question[],
    answers: Record<number, string | string[]>
  ): Question | null {
    // –ß–∏—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞
  }
}

// lib/quiz/services/quizValidation.ts
export class QuizValidationService {
  static validateAnswer(question: Question, answer: string | string[]): boolean {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
  }
  
  static canProceed(question: Question, answers: Record<number, string | string[]>): boolean {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
  }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (unit tests)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 1 –¥–µ–Ω—å

---

### 5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å React.memo –∏ useMemo**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞—é—Ç—Å—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –¢—è–∂–µ–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// components/quiz/QuestionView.tsx
export const QuestionView = React.memo(({ question, answer, onChange }: Props) => {
  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è, –µ—Å–ª–∏ props –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
  return (
    // ...
  );
}, (prevProps, nextProps) => {
  // –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  return prevProps.question.id === nextProps.question.id &&
         prevProps.answer === nextProps.answer;
});

// –í page.tsx
const filteredQuestions = useMemo(() => {
  return filterQuestions(questions, answers);
}, [questions, answers]); // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ questions –∏–ª–∏ answers
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–µ–Ω—å—à–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 0.5 –¥–Ω—è

---

### 6. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ñ–∞–π–ª–∞–º
- –°–ª–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// lib/quiz/config/quizConfig.ts
export const QUIZ_CONFIG = {
  // –¢–∞–π–º–∞—É—Ç—ã
  LOADER_TIMEOUT: 5000,
  FALLBACK_LOADER_TIMEOUT: 10000,
  
  // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  QUESTIONNAIRE_STALE_TIME: 10 * 60 * 1000, // 10 –º–∏–Ω—É—Ç
  PROGRESS_STALE_TIME: 2 * 60 * 1000, // 2 –º–∏–Ω—É—Ç—ã
  
  // SessionStorage keys
  STORAGE_KEYS: {
    CURRENT_INFO_SCREEN: 'quiz_currentInfoScreenIndex',
    CURRENT_QUESTION: 'quiz_currentQuestionIndex',
    INIT_CALLED: 'quiz_initCalled',
  },
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  LOGGING: {
    ENABLED: process.env.NODE_ENV === 'development',
    SEND_TO_SERVER: true,
  },
} as const;
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ –ù–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 0.5 –¥–Ω—è

---

### 7. **–£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- –ù–µ—Ç –µ–¥–∏–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// lib/quiz/errors/quizErrorHandler.ts
export class QuizErrorHandler {
  static handle(error: Error, context: string) {
    // –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    clientLogger.error(`Quiz error in ${context}`, error);
    
    // –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
    if (error instanceof NetworkError) {
      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–µ —Å —Å–µ—Ç—å—é
    } else if (error instanceof ValidationError) {
      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
try {
  await saveProgress();
} catch (error) {
  QuizErrorHandler.handle(error, 'saveProgress');
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï–¥–∏–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚úÖ –õ—É—á—à–∏–π UX
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 0.5 –¥–Ω—è

---

### 8. **–¢–∏–ø–∏–∑–∞—Ü–∏—è —Å TypeScript**

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- –ù–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// lib/quiz/types/index.ts
export interface Question {
  id: number;
  code: string;
  text: string;
  type: string;
  isRequired: boolean;
  options?: QuestionOption[];
}

export interface Questionnaire {
  id: number;
  name: string;
  version: number;
  groups: QuestionGroup[];
  questions: Question[];
}

export type QuizState = 'LOADING' | 'INITIAL_INFO' | 'QUESTIONS' | 'FINALIZING' | 'COMPLETED';

export interface QuizContext {
  questionnaire: Questionnaire | null;
  currentQuestionIndex: number;
  currentInfoScreenIndex: number;
  answers: Record<number, string | string[]>;
  state: QuizState;
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï–¥–∏–Ω—ã–µ —Ç–∏–ø—ã
- ‚úÖ –õ—É—á—à–∏–π –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç
- ‚úÖ –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –≤ runtime

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 0.5 –¥–Ω—è

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- ‚ö° **-30% –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏** (–±–ª–∞–≥–æ–¥–∞—Ä—è React Query –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é)
- ‚ö° **-50% –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤** (–±–ª–∞–≥–æ–¥–∞—Ä—è React.memo –∏ useMemo)
- ‚ö° **-40% —Ä–∞–∑–º–µ—Ä–∞ bundle** (–±–ª–∞–≥–æ–¥–∞—Ä—è code splitting)

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:
- üìù **-70% —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –≤ –≥–ª–∞–≤–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ (7900 ‚Üí ~2400 —Å—Ç—Ä–æ–∫)
- üß™ **+100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** (–±–ª–∞–≥–æ–¥–∞—Ä—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é –Ω–∞ –º–æ–¥—É–ª–∏)
- üêõ **-60% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–µ–±–∞–≥** (–±–ª–∞–≥–æ–¥–∞—Ä—è –ª—É—á—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ)

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
- ‚è±Ô∏è **-50% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏—á**
- üîç **+80% —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞**
- üë• **+100% –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1 –¥–µ–Ω—å)
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TypeScript —Ç–∏–ø—ã
3. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª

### –§–∞–∑–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (1 –¥–µ–Ω—å)
1. –°–æ–∑–¥–∞—Ç—å React Query —Ö—É–∫–∏
2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É questionnaire
3. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### –§–∞–∑–∞ 3: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (2 –¥–Ω—è)
1. –í—ã–Ω–µ—Å—Ç–∏ QuizLoader
2. –í—ã–Ω–µ—Å—Ç–∏ QuizInitializer
3. –í—ã–Ω–µ—Å—Ç–∏ InfoScreenView –∏ QuestionView
4. –û–±–Ω–æ–≤–∏—Ç—å –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

### –§–∞–∑–∞ 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. –î–æ–±–∞–≤–∏—Ç—å React.memo
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å useMemo
3. –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –§–∞–∑–∞ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏
3. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~6 –¥–Ω–µ–π

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å–µ —Å—Ä–∞–∑—É, –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –º–µ—Ä–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 9. **Code Splitting**
```typescript
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const QuizFinalizer = lazy(() => import('./components/QuizFinalizer'));
```

### 10. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤**
–î–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤/–æ–ø—Ü–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `react-window` –∏–ª–∏ `react-virtual`

### 11. **Web Workers**
–î–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Web Workers

### 12. **Service Worker**
–î–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã

- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TypeScript —Ç–∏–ø—ã
- [ ] –°–æ–∑–¥–∞—Ç—å React Query —Ö—É–∫–∏
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ø–µ—Ä–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (QuizLoader)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ —á–∞—Å—Ç—è–º

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-01-27  
**–í–µ—Ä—Å–∏—è:** 1.0

