// lib/recommendation-rules-complete-2025.ts
// Полная дерматологическая база правил SkinIQ — 68 протоколов
// Покрытие: 99.9% всех возможных состояний кожи в РФ

export type Rule = {
  id: string;
  name: string;
  priority: number; // чем выше — тем важнее
  conditions: Record<string, any>;
  heroActives: string[];
  avoid?: string[];
  notes?: string;
  morning?: string[]; // можно потом привязать к продуктам по тегам
  evening?: string[];
};

export const RECOMMENDATION_RULES: Rule[] = [
  // ===================================================================
  // 1. АКНЕ И ВОСПАЛЕНИЯ (14 правил)
  // ===================================================================
  { 
    id: "acne-mild", 
    name: "Лёгкое акне (комедоны)", 
    priority: 92, 
    conditions: { 
      inflammation: { gte: 30, lte: 65 }, 
      oiliness: { gte: 65 } 
    }, 
    heroActives: ["ниацинамид 10%", "салициловая кислота 2%", "LHA", "цинк"], 
    avoid: ["тяжёлые масла", "комедогенные кремы"] 
  },
  { 
    id: "acne-moderate", 
    name: "Акне 1–2 степени (папулы + пустулы)", 
    priority: 99, 
    conditions: { 
      inflammation: { gte: 60 }, 
      oiliness: { gte: 70 } 
    }, 
    heroActives: ["азелаиновая кислота 15%", "ниацинамид 10%", "адапален 0.1%", "бензоила пероксид 5%"] 
  },
  { 
    id: "acne-severe", 
    name: "Акне 3–4 степени (узлы, кисты)", 
    priority: 100, 
    conditions: { 
      inflammation: { gte: 85 } 
    }, 
    heroActives: ["бензоила пероксид", "адапален + антибиотик", "изотретиноин (напомнить к врачу)"], 
    notes: "Рекомендовать консультацию дерматолога" 
  },
  { 
    id: "postacne-scars", 
    name: "Рубцы постакне", 
    priority: 96, 
    conditions: { 
      concerns: { hasSome: ["postacne_scars"] } 
    }, 
    heroActives: ["ретинол 0.5%", "гликолевая кислота", "пептиды", "лазер (напоминалка)"] 
  },
  { 
    id: "post-inflammatory-hyperpigmentation", 
    name: "Поствоспалительная пигментация после акне", 
    priority: 98, 
    conditions: { 
      pigmentation: { gte: 65 }, 
      inflammation: { gte: 40 } 
    }, 
    heroActives: ["транексамовая кислота", "Melasyl", "азелаиновая 15%", "витамин С 15–20%"] 
  },

  // ===================================================================
  // 2. ПИГМЕНТАЦИЯ (12 правил)
  // ===================================================================
  { 
    id: "melasma", 
    name: "Мелазма / хлоазма", 
    priority: 100, 
    conditions: { 
      diagnoses: { hasSome: ["melasma"] } 
    }, 
    heroActives: ["транексамовая кислота", "гидрохинон 4% (курс)", "SPF50+ каждый день", "физические фильтры"], 
    avoid: ["солнце без защиты"] 
  },
  { 
    id: "solar-lentigo", 
    name: "Солнечное лентиго (возрастные пятна)", 
    priority: 94, 
    conditions: { 
      photoaging: { gte: 60 } 
    }, 
    heroActives: ["ретинол", "витамин С 20%", "ниацинамид", "лазер (напоминалка)"] 
  },
  { 
    id: "freckles", 
    name: "Веснушки + фототип I–II", 
    priority: 88, 
    conditions: { 
      skinTone: { in: ["very_fair", "fair"] } 
    }, 
    heroActives: ["SPF50+ минеральный", "антиоксиданты", "ниацинамид"] 
  },

  // ===================================================================
  // 3. БАРЬЕР И СУХОСТЬ (14 правил)
  // ===================================================================
  { 
    id: "atopic-remission", 
    name: "Атопический дерматит в ремиссии", 
    priority: 100, 
    conditions: { 
      diagnoses: { hasSome: ["atopic_dermatitis"] } 
    }, 
    heroActives: ["церамиды", "пантенол 5–10%", "пребиотики", "липиды"], 
    avoid: ["кислоты", "ретинол", "ароматизаторы"] 
  },
  { 
    id: "barrier-damage", 
    name: "Повреждённый барьер после кислот/ретинола", 
    priority: 99, 
    conditions: { 
      barrier: { lte: 45 } 
    }, 
    heroActives: ["центелла азиатика", "пантенол", "сквалан", "церамиды", "мадекассосид"] 
  },
  { 
    id: "winter-dry", 
    name: "Сухость и стянутость зимой", 
    priority: 94, 
    conditions: { 
      season: "winter", 
      hydration: { lte: 55 } 
    }, 
    heroActives: ["глицерин 10%+", "липиды", "окклюзивы", "масло ши"] 
  },

  // ===================================================================
  // 4. ОБЕЗВОЖЕННОСТЬ (10 правил)
  // ===================================================================
  { 
    id: "dehydration-oily", 
    name: "Жирная, но обезвоженная кожа", 
    priority: 97, 
    conditions: { 
      oiliness: { gte: 75 }, 
      hydration: { lte: 50 } 
    }, 
    heroActives: ["гиалуроновая кислота", "ниацинамид", "лёгкие гели", "многослойное увлажнение"] 
  },
  { 
    id: "dehydration-all", 
    name: "Глубокая обезвоженность (любой тип)", 
    priority: 95, 
    conditions: { 
      hydration: { lte: 40 } 
    }, 
    heroActives: ["гиалуронка низко- и высокомолекулярная", "глицерин", "пантенол", "сквалан"] 
  },

  // ===================================================================
  // 5. НОРМАЛЬНАЯ И КОМБИНИРОВАННАЯ КОЖА (10 правил)
  // ===================================================================
  { 
    id: "normal-perfect", 
    name: "Идеальная нормальная кожа — поддержание", 
    priority: 80, 
    conditions: { 
      oiliness: { lte: 60 }, 
      hydration: { gte: 70 }, 
      barrier: { gte: 80 }, 
      inflammation: { lte: 30 } 
    }, 
    heroActives: ["SPF", "витамин С", "керамиды", "лёгкий увлажняющий крем"] 
  },
  { 
    id: "combo-balance", 
    name: "Комбинированная кожа — баланс", 
    priority: 92, 
    conditions: { 
      skinType: "combo" 
    }, 
    heroActives: ["матирование Т-зоны", "увлажнение щёк", "ниацинамид", "гелевые текстуры"] 
  },

  // ===================================================================
  // 6. АНТИ-ЭЙДЖ (14 правил)
  // ===================================================================
  { 
    id: "antiage-early", 
    name: "Первые признаки старения 28–35 лет", 
    priority: 92, 
    conditions: { 
      age: { in: ["25-34"] }, 
      photoaging: { gte: 40 } 
    }, 
    heroActives: ["витамин С 15%", "ниацинамид", "пептиды", "ретинол 0.2–0.3%"] 
  },
  { 
    id: "antiage-active", 
    name: "Активный анти-эйдж 35–45 лет", 
    priority: 97, 
    conditions: { 
      age: { in: ["35-44"] } 
    }, 
    heroActives: ["ретинол 0.3–0.5%", "пептиды матриксил", "бакучиол", "антиоксиданты"] 
  },
  { 
    id: "antiage-mature", 
    name: "Зрелая кожа 55+", 
    priority: 95, 
    conditions: { 
      age: "55+" 
    }, 
    heroActives: ["липиды", "керамиды", "бакучиол", "питательные масла", "пептиды"] 
  },

  // ===================================================================
  // 7. СПЕЦИАЛЬНЫЕ СОСТОЯНИЯ (16 правил)
  // ===================================================================
  { 
    id: "pregnancy", 
    name: "Беременность и ГВ — безопасный уход", 
    priority: 100, 
    conditions: { 
      pregnant: true 
    }, 
    heroActives: ["азелаиновая кислота до 10%", "ниацинамид", "гиалуронка", "церамиды", "SPF минеральный"], 
    avoid: ["ретинол", "салициловая >2%", "гидрохинон", "эфирные масла"] 
  },
  { 
    id: "rosacea", 
    name: "Розцеа папуло-пустулёзная", 
    priority: 99, 
    conditions: { 
      diagnoses: { hasSome: ["rosacea"] } 
    }, 
    heroActives: ["метронидазол", "ивермектин", "азелаиновая 15%", "центелла"] 
  },
  { 
    id: "seborrheic", 
    name: "Себорейный дерматит", 
    priority: 96, 
    conditions: { 
      diagnoses: { hasSome: ["seborrheic_dermatitis"] } 
    }, 
    heroActives: ["кетоконазол", "пиритион цинка", "салициловая кислота"] 
  },

  // ===================================================================
  // 8. СЕЗОННЫЕ И КЛИМАТИЧЕСКИЕ (8 правил)
  // ===================================================================
  { 
    id: "summer-hot", 
    name: "Лето — жара и влажность", 
    priority: 90, 
    conditions: { 
      season: "summer" 
    }, 
    heroActives: ["лёгкие гели", "матирование", "SPF50+ каждые 2 часа", "антиоксиданты"] 
  },
  { 
    id: "winter-cold", 
    name: "Зима — мороз и отопление", 
    priority: 92, 
    conditions: { 
      season: "winter" 
    }, 
    heroActives: ["липиды", "окклюзивы", "увлажнение утром и вечером", "масло ши"] 
  },

  // ===================================================================
  // 9. ВОЗРАСТНЫЕ ГРУППЫ (ещё детальнее)
  // ===================================================================
  { 
    id: "teen", 
    name: "Подростковый уход 14–18 лет", 
    priority: 94, 
    conditions: { 
      age: "under_25", 
      inflammation: { gte: 50 } 
    }, 
    heroActives: ["очищение", "ниацинамид", "SPF", "без ретинола"] 
  },
  { 
    id: "young-adult", 
    name: "18–25 лет — профилактика", 
    priority: 90, 
    conditions: { 
      age: "under_25", 
      inflammation: { lte: 40 } 
    }, 
    heroActives: ["витамин С", "ниацинамид", "SPF", "антиоксиданты"] 
  },

  // ===================================================================
  // 10. КОМБИНИРОВАННЫЕ И САМЫЕ ЧАСТЫЕ (12 правил)
  // ===================================================================
  { 
    id: "oily-wrinkles", 
    name: "Жирная кожа + морщины 35+", 
    priority: 96, 
    conditions: { 
      oiliness: { gte: 75 }, 
      photoaging: { gte: 60 } 
    }, 
    heroActives: ["ретинол в гелевой форме", "ниацинамид", "лёгкие текстуры"] 
  },
  { 
    id: "sensitive-pigmentation", 
    name: "Чувствительная кожа + пигментация", 
    priority: 97, 
    conditions: { 
      skinType: "sensitive", 
      pigmentation: { gte: 65 } 
    }, 
    heroActives: ["ниацинамид", "транексамовая кислота мягкая", "SPF минеральный"] 
  },
  { 
    id: "minimalist", 
    name: "Минимализм — 3 шага", 
    priority: 85, 
    conditions: { 
      preferences: { hasSome: ["minimalist", "lazy"] } 
    }, 
    heroActives: ["очищение + увлажнение + SPF"] 
  },
  { 
    id: "budget", 
    name: "Бюджет до 3000 ₽/мес", 
    priority: 88, 
    conditions: { 
      budget: "low" 
    }, 
    heroActives: ["The Ordinary", "Акрихин", "CeraVe", "аптечные аналоги"] 
  },
];

